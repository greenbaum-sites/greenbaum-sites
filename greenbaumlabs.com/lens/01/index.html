<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Coherence · Lens 01</title>
  <meta name="description" content="Drag to examine where responsibility actually lands.">

  <!-- OG -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Coherence · Lens 01 · The Operator">
  <meta property="og:description" content="Drag to examine where responsibility actually lands.">
  <meta property="og:image" content="images/og-image.jpg">
  <meta name="twitter:card" content="summary_large_image">

  <!-- Preload critical images -->
  <link rel="preload" href="images/narrative.avif" as="image" type="image/avif">
  <link rel="preload" href="images/structure.avif" as="image" type="image/avif">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;1,300;1,400&family=JetBrains+Mono:wght@300;400&display=swap" rel="stylesheet">

  <style>
    *, *::before, *::after {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg: #0d0d0d;
      --gold: #c9a84c;
      --gold-dim: rgba(201, 168, 76, 0.25);
      --gold-glow: rgba(201, 168, 76, 0.12);
      --text-primary: #e8e4dc;
      --text-warm: #d4cfc6;
      --text-cold: #b8b4ad;
      --text-dim: #4a4744;
      --text-muted: #5a5652;

      /* Image opacity — tune these after seeing the generated images */
      --img-narrative-opacity: 0.08;
      --img-structure-opacity: 0.10;
      --img-structure-opacity-full: 0.14;
      --grain-opacity: 0.04;
    }

    html, body {
      height: 100%;
      overflow: hidden;
      background: var(--bg);
      color: var(--text-primary);
      font-family: 'Cormorant Garamond', serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      user-select: none;
      -webkit-user-select: none;
    }

    /* ========== GRAIN OVERLAY ========== */
    body::after {
      content: '';
      position: fixed;
      inset: 0;
      z-index: 200;
      pointer-events: none;
      background-image: url('images/grain.png');
      background-repeat: repeat;
      background-size: 512px 512px;
      mix-blend-mode: overlay;
      opacity: var(--grain-opacity);
    }

    /* ========== HEADER ========== */
    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
      display: flex;
      justify-content: center;
      padding: 2.2rem 2rem 0;
      pointer-events: none;
    }

    .header-label {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.55rem;
      font-weight: 300;
      letter-spacing: 0.22em;
      text-transform: uppercase;
      color: var(--text-dim);
      display: inline-block;
      opacity: 0;
      animation: softIn 1.4s ease 0.5s forwards;
    }

    /* ========== PROMPT ========== */
    .prompt {
      margin-top: 2rem;
      text-align: center;
      z-index: 90;
      opacity: 0;
      animation: softIn 1.4s ease 2.8s forwards;
      transition: opacity 1.2s ease;
    }

    .prompt.hidden {
      opacity: 0 !important;
      animation: none;
    }

    .prompt-button {
      display: inline-flex;
      align-items: center;
      gap: 0.6em;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.6rem;
      font-weight: 400;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--gold);
      border: 1px solid var(--gold-dim);
      border-radius: 100px;
      padding: 0.7em 1.8em;
      background: rgba(13, 13, 13, 0.6);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      cursor: ew-resize;
      transition: border-color 0.4s ease, color 0.4s ease;
    }

    .prompt-button:hover {
      border-color: var(--gold);
      color: #dfc06a;
    }

    .prompt-arrow {
      display: inline-block;
      font-size: 0.75rem;
      opacity: 0.7;
      animation: nudge 2s ease-in-out infinite;
    }

    @keyframes nudge {
      0%, 100% { transform: translateX(0); }
      50% { transform: translateX(4px); }
    }

    /* ========== LAYERS ========== */
    .layer {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 5rem 4rem;
    }

    .layer-content {
      max-width: 500px;
      text-align: center;
      position: absolute;
      top: 38%;
      left: 50%;
      transform: translateX(-50%);
      z-index: 2;
    }

    .layer-headline {
      font-weight: 400;
      font-size: clamp(1.7rem, 3.2vw, 2.6rem);
      line-height: 1.35;
      margin-bottom: 1.5rem;
    }

    .layer-body {
      font-weight: 300;
      font-size: clamp(0.95rem, 1.3vw, 1.08rem);
      line-height: 1.85;
    }

    /* ---- Narrative layer ---- */
    .layer-narrative {
      z-index: 1;
      transition: opacity 0.8s ease;
    }

    .layer-narrative::before {
      content: '';
      position: absolute;
      inset: 0;
      z-index: 0;
      background-image: var(--narrative-bg);
      background-size: cover;
      background-position: center;
      opacity: var(--img-narrative-opacity);
      transition: opacity 0.8s ease;
    }

    /* Dark vignette to ensure text legibility over image */
    .layer-narrative::after {
      content: '';
      position: absolute;
      inset: 0;
      z-index: 1;
      background: radial-gradient(
        ellipse at center,
        rgba(13, 13, 13, 0.4) 0%,
        rgba(13, 13, 13, 0.65) 50%,
        rgba(13, 13, 13, 0.9) 100%
      );
    }

    .layer-narrative .layer-headline {
      color: var(--text-primary);
      opacity: 0;
      animation: softIn 1s ease 2s forwards;
    }

    .layer-narrative .layer-body {
      color: var(--text-cold);
      opacity: 0;
      animation: softIn 1s ease 2.4s forwards;
    }

    /* ---- Structure layer ---- */
    .layer-structure {
      z-index: 2;
      clip-path: inset(0 85% 0 0);
      background: var(--bg);
    }

    .layer-structure::before {
      content: '';
      position: absolute;
      inset: 0;
      z-index: 0;
      background-image: var(--structure-bg);
      background-size: cover;
      background-position: center;
      opacity: var(--live-structure-opacity, 0.22);
      transition: opacity 0.6s ease;
    }

    .layer-structure::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 1px;
      height: 100%;
      z-index: 1;
      background: rgba(201, 168, 76, 0.1);
    }

    .layer-structure .layer-headline {
      color: var(--text-primary);
    }

    .layer-structure .layer-body {
      color: var(--text-cold);
    }

    /* ========== HANDLE ========== */
    .handle {
      position: fixed;
      top: 0;
      bottom: 0;
      width: 44px;
      left: calc(15% - 22px);
      z-index: 50;
      cursor: ew-resize;
      touch-action: none;
      opacity: 0;
      animation: handleIn 0.8s ease 3s forwards;
    }

    .handle-line {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 1px;
      height: 100%;
      background: var(--gold);
      opacity: 0.25;
      transition: opacity 0.4s ease;
    }

    .handle:hover .handle-line,
    .handle.active .handle-line {
      opacity: 0.55;
    }

    .handle-grip {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 11px;
      height: 11px;
      border-radius: 50%;
      border: 1px solid var(--gold);
      background: var(--bg);
      opacity: 0.6;
      transition: all 0.35s ease;
    }

    .handle:hover .handle-grip,
    .handle.active .handle-grip {
      width: 15px;
      height: 15px;
      opacity: 1;
      box-shadow: 0 0 20px var(--gold-glow);
    }

    /* ========== FM LABEL ========== */
    .fm-label {
      position: fixed;
      bottom: 2.8rem;
      left: 50%;
      transform: translateX(-50%);
      z-index: 60;
      text-align: center;
      opacity: 0;
      transition: opacity 1s ease;
      pointer-events: none;
      white-space: nowrap;
    }

    .fm-label.visible {
      opacity: 1;
    }

    .fm-code {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.5rem;
      font-weight: 400;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: var(--gold);
      margin-bottom: 0.75rem;
    }

    .fm-line {
      font-weight: 300;
      font-style: italic;
      font-size: clamp(0.82rem, 1.1vw, 0.92rem);
      color: var(--text-dim);
      line-height: 1.65;
      white-space: normal;
      max-width: 460px;
      margin: 0 auto;
    }

    /* ========== FOOTER ========== */
    .footer-right {
      position: fixed;
      bottom: 1.5rem;
      right: 2rem;
      z-index: 60;
      opacity: 0;
      transition: opacity 0.8s ease;
      pointer-events: none;
    }

    .footer-right.visible {
      opacity: 1;
      pointer-events: auto;
    }

    .footer-left {
      position: fixed;
      bottom: 1.5rem;
      left: 2rem;
      z-index: 60;
      opacity: 0;
      animation: softIn 1s ease 4s forwards;
    }

    .footer-mono {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.45rem;
      font-weight: 300;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--text-dim);
      text-decoration: none;
      transition: color 0.3s ease;
    }

    .footer-mono:hover {
      color: var(--gold);
    }

    /* ========== KEYFRAMES ========== */
    @keyframes softIn {
      from { opacity: 0; transform: translateY(5px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    @keyframes handleIn {
      from { opacity: 0; }
      to   { opacity: 1; }
    }

    /* ========== REDUCED MOTION ========== */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        animation-delay: 0.01ms !important;
        transition-duration: 0.01ms !important;
      }
      .layer-structure { clip-path: none !important; }
      .layer-narrative { clip-path: none !important; }
      .handle { display: none; }
      .layer-narrative { width: 50%; position: absolute; right: 50%; }
      .layer-structure { width: 50%; position: absolute; left: 50%; }
      .fm-label { opacity: 1 !important; }
    }

    /* ========== MOBILE ========== */
    @media (max-width: 768px) {
      .layer { padding: 6rem 2rem 5rem; }
      .layer-content { max-width: 100%; }
      .fm-label {
        bottom: 4.5rem;
        padding: 0 1.5rem;
        white-space: normal;
      }
      .fm-code { font-size: 0.45rem; }
    }
  </style>
</head>
<body>

  <header class="header">
    <span class="header-label">Coherence · Lens 01 · The Operator</span>
  </header>

  <!-- Narrative Layer -->
  <main class="layer layer-narrative" id="narrative">
    <div class="layer-content">
      <h1 class="layer-headline">&ldquo;We have a culture of ownership.&rdquo;</h1>
      <p class="layer-body">Every team member is empowered to take initiative. We celebrate accountability. We hire people who step up, take responsibility for outcomes, and act with a bias for action.</p>
      <div class="prompt" id="prompt">
        <div class="prompt-button" id="promptButton">
          <span>Drag to examine</span>
          <span class="prompt-arrow">&#8594;</span>
        </div>
      </div>
    </div>
  </main>

  <!-- Structural Layer -->
  <div class="layer layer-structure" id="structure">
    <div class="layer-content">
      <h1 class="layer-headline">You own the problem. You don't own the decision.</h1>
      <p class="layer-body">The system compensated you for carrying this. It never learned from what you built to survive it. The fixes, the workarounds, the things you figured out — they stay with you. When you leave, they leave too.</p>
    </div>
  </div>

  <!-- Handle -->
  <div class="handle" id="handle"
       role="slider"
       aria-label="Reveal structural reality"
       aria-valuenow="15"
       aria-valuemin="0"
       aria-valuemax="100"
       tabindex="0">
    <div class="handle-line"></div>
    <div class="handle-grip"></div>
  </div>

  <!-- FM Label -->
  <div class="fm-label" id="fmLabel">
    <div class="fm-code">FM-01 · Responsibility Compression at the Edge</div>
    <p class="fm-line">When the system depends on people instead of design, the weight always lands in the same place.</p>
  </div>

  <!-- Footer -->
  <div class="footer-right" id="footerRight">
    <span class="footer-mono" style="cursor: default;">Explore another lens →</span>
  </div>

  <div class="footer-left">
    <a class="footer-mono" href="https://greenbaumlabs.com">greenbaumlabs</a>
  </div>

  <script>
    (function () {
      'use strict';

      // ---- Image format detection + background application ----
      // Test AVIF support, fallback to WebP
      var avifTest = new Image();
      avifTest.onload = function () { applyBackgrounds('avif'); };
      avifTest.onerror = function () { applyBackgrounds('webp'); };
      avifTest.src = 'data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUEAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABoAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLanAyaAAAAAAAAgABAACAAAABQAAAAAAAAAAAAAAAAAAAAAAeaXBtYQAAAAAAAAABAAEEAQKDBAAAARptZGF0EgAKBzgABhAQ0EkA';

      function applyBackgrounds(format) {
        var ext = format === 'avif' ? 'avif' : 'webp';
        document.documentElement.style.setProperty(
          '--narrative-bg',
          'url(images/narrative.' + ext + ')'
        );
        document.documentElement.style.setProperty(
          '--structure-bg',
          'url(images/structure.' + ext + ')'
        );
      }

      // ---- Elements ----
      var handle     = document.getElementById('handle');
      var structure  = document.getElementById('structure');
      var narrative  = document.getElementById('narrative');
      var fmLabel    = document.getElementById('fmLabel');
      var footerR    = document.getElementById('footerRight');
      var prompt     = document.getElementById('prompt');

      var pct        = 15;
      var dragging   = false;
      var startX     = 0;
      var startPct   = 0;
      var touched    = false;

      // ---- Core position logic ----
      function setPosition(p) {
        pct = Math.max(0, Math.min(100, p));
        var px = (pct / 100) * window.innerWidth;

        // Position handle
        handle.style.left = (px - 22) + 'px';

        // Clip structural layer (reveals from left)
        structure.style.clipPath = 'inset(0 ' + (100 - pct) + '% 0 0)';

        // Clip narrative layer inversely (hides from left where structure is revealed)
        narrative.style.clipPath = 'inset(0 0 0 ' + pct + '%)';

        // ARIA
        handle.setAttribute('aria-valuenow', Math.round(pct));

        // ---- Opacity dynamics ----

        // Narrative layer: subtle fade past 80%
        if (pct > 80) {
          var narrativeFade = 1 - ((pct - 80) / 20) * 0.15;
          narrative.style.opacity = narrativeFade;
        } else {
          narrative.style.opacity = 1;
        }

        // Structure background: intensify as it reveals
        // Ramps from 0.10 to 0.14 across the full drag range
        var structImgOpacity = 0.10 + (pct / 100) * 0.04;
        structure.style.setProperty('--live-structure-opacity', structImgOpacity);

        // FM label at >55%
        if (pct > 55) fmLabel.classList.add('visible');
        else fmLabel.classList.remove('visible');

        // Footer at >80%
        if (pct > 80) footerR.classList.add('visible');
        else footerR.classList.remove('visible');
      }

      function firstTouch() {
        if (!touched) {
          touched = true;
          prompt.classList.add('hidden');
        }
      }

      // ---- Prompt button click ----
      var promptButton = document.getElementById('promptButton');
      if (promptButton) {
        promptButton.addEventListener('click', function () {
          firstTouch();
          setPosition(50);
        });
      }

      // ---- Pointer events ----
      handle.addEventListener('pointerdown', function (e) {
        e.preventDefault();
        handle.setPointerCapture(e.pointerId);
        dragging = true;
        startX   = e.clientX;
        startPct = pct;
        handle.classList.add('active');
        firstTouch();
      });

      document.addEventListener('pointermove', function (e) {
        if (!dragging) return;
        e.preventDefault();
        var dx = e.clientX - startX;
        setPosition(startPct + (dx / window.innerWidth) * 100);
      });

      document.addEventListener('pointerup', function () {
        if (!dragging) return;
        dragging = false;
        handle.classList.remove('active');
      });

      // ---- Keyboard ----
      handle.addEventListener('keydown', function (e) {
        var n = pct;
        switch (e.key) {
          case 'ArrowRight': n += 5;   break;
          case 'ArrowLeft':  n -= 5;   break;
          case 'PageDown':   n += 20;  break;
          case 'PageUp':     n -= 20;  break;
          case 'End':        n = 100;  break;
          case 'Home':       n = 0;    break;
          default: return;
        }
        e.preventDefault();
        firstTouch();
        setPosition(n);
      });

      // ---- Resize ----
      window.addEventListener('resize', function () {
        setPosition(pct);
      });

      // ---- Init ----
      setPosition(15);
    })();
  </script>

</body>
</html>
